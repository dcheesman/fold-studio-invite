<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Simple Video Recorder - The Fold</title>
    <style>
        body {
            background: #000000;
            color: #ffffff;
            font-family: 'Courier New', Courier, monospace;
            margin: 0;
            padding: 20px;
            display: flex;
            flex-direction: column;
            align-items: center;
        }
        
        .controls {
            margin-bottom: 20px;
            text-align: center;
        }
        
        button {
            background: #ffaa00;
            color: #000000;
            border: none;
            padding: 15px 30px;
            margin: 10px;
            font-family: 'Courier New', Courier, monospace;
            font-size: 18px;
            cursor: pointer;
            border-radius: 3px;
            font-weight: bold;
        }
        
        button:hover {
            background: #ff8800;
        }
        
        button:disabled {
            background: #666666;
            cursor: not-allowed;
        }
        
        .info {
            margin-top: 20px;
            text-align: center;
            max-width: 800px;
        }
        
        .status {
            margin-top: 10px;
            padding: 15px;
            background: #1a1a1a;
            border: 2px solid #ffaa00;
            border-radius: 5px;
            font-size: 16px;
        }
        
        #preview-container {
            border: 3px solid #ffaa00;
            border-radius: 5px;
            margin: 20px 0;
            overflow: hidden;
        }
        
        #preview-iframe {
            border: none;
            display: block;
        }
        
        .download-section {
            margin-top: 20px;
            padding: 20px;
            background: #1a1a1a;
            border: 2px solid #ff0033;
            border-radius: 5px;
        }
        
        .download-section h3 {
            color: #ff0033;
            margin-top: 0;
        }
        
        .instructions {
            background: #1a1a1a;
            border: 2px solid #4a4a4a;
            border-radius: 5px;
            padding: 20px;
            margin-top: 20px;
            text-align: left;
        }
    </style>
</head>
<body>
    <h1>THE FOLD - Simple Video Recorder</h1>
    
    <div class="controls">
        <button onclick="startSquareRecording()" id="squareBtn">Record Square (1080x1080)</button>
        <button onclick="startVerticalRecording()" id="verticalBtn">Record Vertical (1080x1920)</button>
        <button onclick="stopRecording()" id="stopBtn" disabled>Stop Recording</button>
        <button onclick="resetPreview()" id="resetBtn">Reset</button>
    </div>
    
    <div id="preview-container">
        <iframe id="preview-iframe" src="https://fold-studio-invite.vercel.app/friday.html" width="800" height="600"></iframe>
    </div>
    
    <div class="status" id="status">
        Ready to record. Choose an aspect ratio above.
    </div>
    
    <div class="download-section" id="downloadSection" style="display: none;">
        <h3>Recording Complete!</h3>
        <p>Your video frames have been captured. Click the download button below to get a ZIP file with all frames.</p>
        <button onclick="downloadFrames()" id="downloadBtn">Download Frames ZIP</button>
        <p><strong>Note:</strong> You'll need to convert these frames to video using software like FFmpeg, After Effects, or online converters.</p>
    </div>

    <div class="instructions">
        <h3>Instructions:</h3>
        <ol>
            <li>Click "Record Square" or "Record Vertical" to start</li>
            <li>Wait for the animation to complete (about 12 seconds)</li>
            <li>Click "Stop Recording" when done</li>
            <li>Download the ZIP file with all frames</li>
            <li>Convert frames to video using your preferred software</li>
        </ol>
        
        <h3>Frame Conversion Commands:</h3>
        <p><strong>FFmpeg (recommended):</strong></p>
        <p><code>ffmpeg -framerate 30 -i frame_%04d.png -c:v libx264 -pix_fmt yuv420p output.mp4</code></p>
        
        <p><strong>For Square (1080x1080):</strong></p>
        <p><code>ffmpeg -framerate 30 -i frame_%04d.png -c:v libx264 -pix_fmt yuv420p -s 1080x1080 fold-square.mp4</code></p>
        
        <p><strong>For Vertical (1080x1920):</strong></p>
        <p><code>ffmpeg -framerate 30 -i frame_%04d.png -c:v libx264 -pix_fmt yuv420p -s 1080x1920 fold-vertical.mp4</code></p>
        
        <h3>Important: Use Deployed Version</h3>
        <p><strong>For frame capture to work:</strong> Use the deployed version at:</p>
        <p><code>https://fold-studio-invite.vercel.app/simple-recorder.html</code></p>
        <p>Local files (file://) have CORS restrictions that prevent frame capture.</p>
        
        <h3>Alternative: Use Screen Recording Software</h3>
        <p>If frame capture still doesn't work, you can also:</p>
        <ol>
            <li>Use OBS Studio (free) to record your screen</li>
            <li>Set the recording area to the iframe above</li>
            <li>Record in the desired resolution</li>
            <li>Export as MP4</li>
        </ol>
    </div>

    <script>
        let isRecording = false;
        let currentAspectRatio = '';
        let frameCount = 0;
        let frames = [];
        let recordingStartTime = 0;
        let recordingInterval;
        
        function startSquareRecording() {
            startRecording('square', 1080, 1080);
        }
        
        function startVerticalRecording() {
            startRecording('vertical', 1080, 1920);
        }
        
        function startRecording(aspectRatio, width, height) {
            isRecording = true;
            currentAspectRatio = aspectRatio;
            frameCount = 0;
            frames = [];
            recordingStartTime = Date.now();
            
            // Update iframe size
            const iframe = document.getElementById('preview-iframe');
            const container = document.getElementById('preview-container');
            
            if (aspectRatio === 'square') {
                iframe.width = '600';
                iframe.height = '600';
                container.style.width = '600px';
                container.style.height = '600px';
            } else {
                iframe.width = '400';
                iframe.height = '711';
                container.style.width = '400px';
                container.style.height = '711px';
            }
            
            // Update UI
            document.getElementById('squareBtn').disabled = true;
            document.getElementById('verticalBtn').disabled = true;
            document.getElementById('stopBtn').disabled = false;
            document.getElementById('resetBtn').disabled = true;
            document.getElementById('status').textContent = `Recording ${aspectRatio} video (${width}x${height})...`;
            document.getElementById('downloadSection').style.display = 'none';
            
            // Start capturing frames
            recordingInterval = setInterval(captureFrame, 33); // 30fps
            
            console.log(`Started recording ${aspectRatio} video (${width}x${height})`);
        }
        
        function stopRecording() {
            isRecording = false;
            
            if (recordingInterval) {
                clearInterval(recordingInterval);
            }
            
            // Update UI
            document.getElementById('squareBtn').disabled = false;
            document.getElementById('verticalBtn').disabled = false;
            document.getElementById('stopBtn').disabled = true;
            document.getElementById('resetBtn').disabled = false;
            document.getElementById('status').textContent = `Recording stopped. Captured ${frameCount} frames.`;
            document.getElementById('downloadSection').style.display = 'block';
            
            console.log(`Recording stopped. Captured ${frameCount} frames.`);
        }
        
        function resetPreview() {
            if (isRecording) {
                stopRecording();
            }
            
            // Reset iframe size
            const iframe = document.getElementById('preview-iframe');
            const container = document.getElementById('preview-container');
            
            iframe.width = '800';
            iframe.height = '600';
            container.style.width = '800px';
            container.style.height = '600px';
            
            // Reset UI
            document.getElementById('squareBtn').disabled = false;
            document.getElementById('verticalBtn').disabled = false;
            document.getElementById('stopBtn').disabled = true;
            document.getElementById('resetBtn').disabled = false;
            document.getElementById('status').textContent = 'Ready to record. Choose an aspect ratio above.';
            document.getElementById('downloadSection').style.display = 'none';
        }
        
        function captureFrame() {
            if (!isRecording) return;
            
            try {
                const iframe = document.getElementById('preview-iframe');
                const canvas = document.createElement('canvas');
                const ctx = canvas.getContext('2d');
                
                // Set canvas size to match iframe
                canvas.width = parseInt(iframe.width);
                canvas.height = parseInt(iframe.height);
                
                // Try to capture from iframe (this might not work due to CORS)
                try {
                    ctx.drawImage(iframe, 0, 0);
                    const dataURL = canvas.toDataURL('image/png');
                    const base64Data = dataURL.split(',')[1];
                    frames.push(base64Data);
                    frameCount++;
                    
                    if (frameCount % 30 === 0) {
                        console.log(`Captured ${frameCount} frames...`);
                    }
                } catch (e) {
                    console.log('Cannot capture from iframe due to CORS restrictions');
                    // Fallback: create a placeholder frame
                    ctx.fillStyle = '#000000';
                    ctx.fillRect(0, 0, canvas.width, canvas.height);
                    ctx.fillStyle = '#ff0033';
                    ctx.font = '24px Courier New';
                    ctx.textAlign = 'center';
                    ctx.fillText('CORS BLOCKED', canvas.width/2, canvas.height/2);
                    ctx.fillText('Use screen recording instead', canvas.width/2, canvas.height/2 + 30);
                    
                    const dataURL = canvas.toDataURL('image/png');
                    const base64Data = dataURL.split(',')[1];
                    frames.push(base64Data);
                    frameCount++;
                }
            } catch (e) {
                console.error('Error capturing frame:', e);
            }
        }
        
        function downloadFrames() {
            if (frames.length === 0) {
                alert('No frames to download!');
                return;
            }
            
            // Create ZIP file with all frames
            const zip = new JSZip();
            
            frames.forEach((frameData, index) => {
                const filename = `frame_${String(index + 1).padStart(4, '0')}.png`;
                zip.file(filename, frameData, { base64: true });
            });
            
            zip.generateAsync({ type: 'blob' }).then(function(content) {
                const url = URL.createObjectURL(content);
                const a = document.createElement('a');
                a.href = url;
                a.download = `fold-${currentAspectRatio}-frames.zip`;
                a.click();
                URL.revokeObjectURL(url);
            });
        }
    </script>
    
    <!-- Include JSZip for creating ZIP files -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jszip/3.10.1/jszip.min.js"></script>
</body>
</html>
